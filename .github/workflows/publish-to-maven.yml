name: Publish package to the Maven Central Repository
on: workflow_dispatch
    
    
  # push:
  #   tags: ["*"]

  # release:
  #   types: [created]

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source
        uses: actions/checkout@v2
      

      # - id: install-secret-key
      #   name: Install gpg secret key
      #   run: |
      #     cat <(echo -e "${{ secrets.secrets.MAVEN_GPG_PRIVATE_KEY }}") | gpg --batch --import
      #     gpg --list-secret-keys --keyid-format LONG

      - name: Import GPG key
        id: import_gpg
        uses: crazy-max/ghaction-import-gpg@v5
        with:
          gpg_private_key: ${{ secrets.MAVEN_GPG_PRIVATE_KEY }}
          passphrase: ${{ secrets.MAVEN_GPG_PASSPHRASE }}
      
      - name: List keys
        run: gpg -K

      - name: Set up JDK 8
        uses: actions/setup-java@v2
        with:
          java-version: "8"
          distribution: "temurin"
          server-id: ossrh
          server-username: OSSRH_USERNAME
          server-password: OSSRH_PASSWORD
          gpg-private-key: ${{ secrets.MAVEN_GPG_PRIVATE_KEY }}
          gpg-passphrase: MAVEN_GPG_PASSPHRASE #${{ secrets.MAVEN_GPG_PASSPHRASE }}


      # - name: Set up JDK 8
      #   uses: actions/setup-java@v2
      #   with:
      #     java-version: "8"
      #     distribution: "temurin"
      

      
      # - name: Compile
      #   run: sbt compile
      
      # - name: Sbt ci release
      #   # uses: olafurpg/setup-scala@v13
      #   run: |
      #     export GPG_TTY=$(tty)
      #     .github/decodekey.sh
      #     sbt ci-release
      #   env:
      #     PGP_PASSPHRASE: ${{ secrets.PGP_PASSPHRASE }}
      #     PGP_SECRET: ${{ secrets.PGP_SECRET }}
      #     SONATYPE_PASSWORD: ${{ secrets.SONATYPE_PASSWORD }}
      #     SONATYPE_USERNAME: ${{ secrets.SONATYPE_USERNAME }}

      - name: Build and Publish package
        run: |
          # export GPG_TTY=$(tty)
          sbt reload
          sbt publishSigned
          sbt sonatypeBundleRelease
        env:
          OSSRH_USERNAME: ${{ secrets.SONATYPE_USERNAME }}
          OSSRH_PASSWORD: ${{ secrets.SONATYPE_PASSWORD }}
          MAVEN_GPG_PASSPHRASE: ${{ secrets.MAVEN_GPG_PASSPHRASE }}