name: Feathr Scala Tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 8
      uses: actions/setup-java@v2
      with:
        java-version: '8'
        distribution: 'temurin'
    - name: Run tests
      run: sbt test
    - name: Build JAR
      run: sbt assembly
    - name: Azure Blob Storage Upload
      uses: fixpoint/azblob-upload-artifact@v4
      with:
        connection-string: ${{secrets.JAR_BLOB_CONNECTION_STRING}}
        name: Feathr JAR
        path: 'target/scala-2.11/feathr-assembly-0.1.0-SNAPSHOT.JAR'
        container: ${{secrets.JAR_BLOB_CONTAINER}}